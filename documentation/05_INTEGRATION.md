# Интеграция с IDE и AI клиентами

## Выбор режима работы

MCP сервер поддерживает два режима работы:

### STDIO режим (рекомендуется для локальной разработки)
- **Применение** — Claude Desktop, Cursor IDE, VS Code
- **Преимущества** — простота настройки, низкие накладные расходы
- **Настройка** — через конфигурационные файлы IDE

### SSE режим (рекомендуется для сетевого доступа)
- **Применение** — веб-клиенты, удаленные подключения, REST API
- **Преимущества** — сетевой доступ, встроенный веб-интерфейс
- **Настройка** — через URL подключения

## STDIO интеграция

### Claude Desktop

Добавьте конфигурацию в `claude_desktop_config.json`:

#### Linux/Mac
```json
{
  "mcpServers": {
    "1c-platform": {
      "command": "java",
      "args": [
        "-jar", 
        "/path/to/mcp-bsl-context.jar", 
        "--platform-path", 
        "/opt/1cv8/x86_64/8.3.25.1257"
      ]
    }
  }
}
```

#### Windows
Важно указать каталог bin платформы без указания пути с пробелами:
```json
{
  "mcpServers": {
    "1c-platform": {
      "command": "java",
      "args": [
        "-jar", 
        "C:\\ваш\\путь\\mcp-bsl-context.jar", 
        "--platform-path", 
        "C:\\Progra~1\\1cv8\\8.3.23.1912\\bin"
      ]
    }
  }
}
```

Либо через переменные среды:
```json
{
  "mcpServers": {
    "1c-platform": {
      "command": "java",
      "args": [
        "-jar", 
        "C:\\ваш\\путь\\mcp-bsl-context.jar"
      ],
      "env": {
        "PLATFORM_CONTEXT_PATH": "C:\\Program Files\\1cv8\\8.3.21.1644\\bin"
      }
    }
  }
}
```

### Cursor IDE

Cursor поддерживает MCP серверы через конфигурационные файлы. Для подключения MCP сервера платформы 1С:

#### Настройка MCP сервера

Создайте файл `.cursor/mcp.json` в корне проекта (для использования только в текущем проекте) или откройте настройки Cursor (Settings → MCP Servers) для использования во всех проектах:

##### Linux/Mac
```json
{
  "mcpServers": {
    "1c-platform": {
      "command": "java",
      "args": [
        "-jar", 
        "/path/to/mcp-bsl-context.jar", 
        "--platform-path", 
        "/opt/1cv8/x86_64/8.3.25.1257"
      ]
    }
  }
}
```

##### Windows
Важно указать каталог bin платформы без указания пути с пробелами:
```json
{
  "mcpServers": {
    "1c-platform": {
      "command": "java",
      "args": [
        "-jar", 
        "C:\\ваш\\путь\\mcp-bsl-context.jar", 
        "--platform-path", 
        "C:\\Progra~1\\1cv8\\8.3.23.1912\\bin"
      ]
    }
  }
}
```

#### Настройка правил для работы с 1С API (рекомендуется)

##### Через интерфейс Cursor (Settings → Rules):
1. Откройте настройки Cursor (⌘,)
2. Перейдите в раздел "Rules"
3. Нажмите "+" для создания нового правила
4. Заполните поля:
   - **Название**: `1С Platform Development`
   - **Описание**: `Правила для разработки на платформе 1С с использованием MCP API`
   - **Glob pattern**: `**/*.bsl` (для BSL файлов)
   - **Правило**:
   ```
   - Всегда используй MCP инструменты для поиска методов и типов платформы 1С
   - При написании BSL кода проверяй существующие методы через mcp 1c-platform метод search
   - Для сложных типов получай полную информацию через mcp 1c-platform метод info
   - Используй актуальные сигнатуры методов из MCP сервера
   ```

##### Через файловую систему (.cursor/rules):
Создайте файл `.cursor/rules/1c-platform.md`:

```markdown
---
title: 1С Platform Development
description: Правила для разработки на платформе 1С с использованием MCP API
globs: ["**/*.bsl"]
---

# Правила разработки на платформе 1С

- Всегда используй MCP инструменты для поиска методов и типов платформы 1С
- При написании BSL кода проверяй существующие методы через mcp 1c-platform метод search
- Для сложных типов получай полную информацию через mcp 1c-platform метод info
- Используй актуальные сигнатуры методов из MCP сервера
- Предпочитай использовать стандартные методы платформы вместо самописных решений
```

#### Проверка подключения
1. Откройте настройки Cursor (Settings → MCP Servers)
2. Убедитесь что сервер `1c-platform` отображается как подключенный
3. Проверьте список доступных инструментов:
   - `search` - поиск по API платформы 1С
   - `info` - детальная информация об элементах API
   - `getMember` - информация о конкретном методе или свойстве типа
   - `getMembers` - полный список всех методов и свойств типа
   - `getConstructors` - список конструкторов типа данных

#### Использование в Cursor Tab
Cursor автоматически использует MCP инструменты при необходимости. Для явного использования можно:
- Задать вопрос в чате: "Найди методы для работы с файлами в 1С"
- Попросить: "Покажи сигнатуру метода НайтиФайлы"
- Команда: "Список всех доступных инструментов"
- Запросить: "Покажи все методы типа СправочникСсылка"
- Узнать: "Как создать новый массив в 1С?" (использует getConstructors)
- Получить детали: "Что делает метод Записать у ДокументОбъект?"

## SSE интеграция

### Запуск SSE сервера

```bash
# Запуск SSE сервера
java -jar mcp-bsl-context.jar --mode sse --platform-path "/path/to/1c/platform" --port 8080
```

### Подключение через URL

#### Claude Desktop
```json
{
  "mcpServers": {
    "1c-platform-sse": {
      "url": "http://localhost:8080/sse"
    }
  }
}
```

#### Cursor IDE
```json
{
  "mcpServers": {
    "1c-platform-sse": {
      "url": "http://localhost:8080/sse"
    }
  }
}
```

## Интеграция с Docker

### STDIO (локальный запуск через docker)

```json
{
  "mcpServers": {
    "1c-platform-stdio": {
      "command": "docker",
      "args": [
        "run", "--rm", "-i",
        "-v", "/opt/1cv8/x86_64/8.3.25.1257:/app/1c-platform:ro",
        "ghcr.io/alkoleft/mcp-bsl-context:v0.2.1-stdio",
        "--platform-path", "/app/1c-platform"
      ]
    }
  }
}
```

### SSE (сетевой режим)

```json
{
  "mcpServers": {
    "1c-platform-sse": {
      "url": "http://localhost:8001/sse"
    }
  }
}
```

#### Docker Compose для SSE

```yaml
version: '3.8'
services:
  mcp-server:
    build:
      context: .
      dockerfile: Dockerfile.sse
    ports:
      - "8080:8080"
    volumes:
      - /path/to/1c/platform:/app/1c-platform:ro
    environment:
      - PLATFORM_CONTEXT_PATH=/app/1c-platform
```

## Другие MCP клиенты

Сервер поддерживает стандартный MCP протокол через STDIO и HTTP/SSE транспорты, поэтому совместим с любыми MCP клиентами:

- **Claude Desktop** - нативная поддержка MCP
- **Cursor IDE** - встроенная поддержка MCP серверов
- **VS Code** - через расширения MCP
- **JetBrains IDEs** - через плагины MCP
- **Веб-клиенты** - через SSE транспорт
- **Другие AI ассистенты** - поддерживающие MCP протокол

## Проверка работоспособности

### Тестовые запросы

После настройки интеграции проверьте работу сервера следующими запросами:

1. **Поиск методов:**
   ```
   Найди методы для работы с файлами в 1С
   ```

2. **Получение информации:**
   ```
   Покажи сигнатуру метода НайтиФайлы
   ```

3. **Работа с типами:**
   ```
   Покажи все методы типа СправочникСсылка
   ```

4. **Конструкторы:**
   ```
   Как создать новый массив в 1С?
   ```

### Диагностика проблем

Если интеграция не работает:

1. **Проверьте логи сервера** - убедитесь что сервер запущен и работает
2. **Проверьте конфигурацию** - убедитесь что пути и параметры корректны
3. **Перезапустите IDE** - после изменения конфигурации MCP
4. **Проверьте версии** - убедитесь в совместимости версий MCP протокола
5. **Для SSE режима** - проверьте доступность порта и сетевые настройки

## Примеры использования

### Поиск и изучение API

```bash
# Поиск методов для работы с датами
Поиск: "дата"

# Получение информации о конкретном методе
Информация: "ТекущаяДата"

# Изучение типа данных
Тип: "Дата"
```

### Разработка кода

```bash
# Поиск подходящих методов
Поиск: "записать документ"

# Получение сигнатуры
Информация: "Записать"

# Изучение типа документа
Тип: "ДокументОбъект"
```

### Отладка и анализ

```bash
# Поиск методов отладки
Поиск: "отладка"

# Получение информации о логировании
Информация: "ЗаписатьЖурналРегистрации"

# Изучение типов для работы с ошибками
Тип: "ОписаниеОшибки"
```

## Дополнительные ресурсы

- [SSE документация](SSE_USAGE.md) - подробная информация о SSE режиме
- [Docker документация](03_DOCKER.md) - инструкции по работе с Docker
- [Техническая документация](04_TECHNICAL.md) - архитектура и технические детали 